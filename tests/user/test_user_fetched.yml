---
- name: Test ipauser random password generation
  hosts: ipaserver
  become: true

  tasks:
  # setup
  - name: Users user1 and user2 present
    ipauser:
      ipaadmin_password: SomeADMINpassword
      users:
      - name: user1
        first: first1
        last: last1
      - name: user2
        first: first2
        last: last2

  # tests
  - name: Fetch user list
    ipauser:
      ipaadmin_password: SomeADMINpassword
      state: fetched
    register: result
    failed_when: result.changed or result.failed

  - name: Print fetched information
    debug:
      var: result

  - name: Fetch user user1 information
    ipauser:
      ipaadmin_password: SomeADMINpassword
      name:
      - user1
      fetch_param: all
      state: fetched
    register: result
    failed_when: result.changed or result.failed

  - name: Print fetched information
    debug:
      var: result

  - name: Fetch users information
    ipauser:
      ipaadmin_password: SomeADMINpassword
      name:
      - user1
      - user2
      - user100
      state: fetched
    register: result
    failed_when: result.changed or result.failed

  - name: Print fetched information
    debug:
      var: result

  - name: Fetch user information for given parameters
    ipauser:
      ipaadmin_password: SomeADMINpassword
      fetch_param:
      - uid
      - first
      - last
      state: fetched
    register: result
    failed_when: result.changed or result.failed

  - name: Print fetched information
    debug:
      var: result

  - name: Fetch user information for given parameters for selected users
    ipauser:
      ipaadmin_password: SomeADMINpassword
      name:
      - user1
      - user100
      fetch_param:
      - uid
      - first
      - last
      state: fetched
    register: result
    failed_when: result.changed or result.failed

  - name: Print fetched information
    debug:
      var: result

  # cleanup
  - name: Users user1 and user2 absent
    ipauser:
      ipaadmin_password: SomeADMINpassword
      name:
      - user1
      - user2
      state: absent
